(()=>{var s={739:(s,e,t)=>{const r=t(185),a=process.env.DB_URL.replace("<username>",process.env.DB_USER).replace("<password>",process.env.DB_PASS);s.exports=async()=>{try{await r.connect(a)}catch(s){throw s}}},218:(s,e,t)=>{const r=t(406),a=t(344),o=t(185);s.exports=async(s,e)=>{const{email:t,password:n}=s.body,i=[];if(["email","password"].forEach((e=>{const t=((s,e)=>{switch(s){case"email":if(!e)return"Email is required.";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return"Please enter a valid email address";break;case"password":if(!e)return"Password is required."}})(e,s.body[e]);t&&i.push(t)})),i.length>0)return e.status(400).json({status:"Failed",error:i});try{const s=await r.findOne({$or:[{email:t}]});if(!s)return e.status(400).json({status:"Failed",error:"User with this email does not exist"});if(!await s.correctPassword(n,s.password))return e.status(401).json({status:"failed",message:"Invalid password"});const i=((s,e)=>a.sign({email:s,_id:e},process.env.JWT_SECRET,{expiresIn:process.env.JWT_EXPIRES_IN}))(t,new o.Types.ObjectId(s._id).toString());e.status(201).json({status:"Success",message:"User logged in successfully",token:i})}catch(s){e.status(500).json({status:"Failed",error:s.message})}}},89:(s,e,t)=>{const r=t(344);s.exports=async(s,e)=>{const t=s.headers.authorization;if(!t||!t.startsWith("Bearer "))return e.status(401).json({status:"failed",message:"Unauthorized"});const a=t.split(" ")[1];if(!a)return e.status(401).json({status:"failed",message:"Unauthorized"});try{const s=r.verify(a,process.env.JWT_SECRET);return e.status(200).json({status:"success",userId:s._id})}catch(s){return e.status(401).json({status:"failed",message:"Unauthorized"})}}},318:(s,e,t)=>{const r=t(406),a=t(344);s.exports=async(s,e)=>{const{firstName:t,lastName:o,email:n,password:i,cpassword:c}=s.body,u=[];if(["firstName","lastName","email","password","cpassword"].forEach((e=>{const t=((s,e,t)=>{switch(s){case"firstName":if(!e||""===e.trim())return"First name is required";break;case"lastName":if(!e||""===e.trim())return"Last name is required";break;case"email":if(!e)return"Email is required.";if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return"Please enter a valid email address";break;case"password":if(!e||e.length<8||!/[A-Z]/.test(e)||!/[a-z]/.test(e)||!/[0-9]/.test(e)||!/[!@#$%^&*]/.test(e))return"Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, one digit, and one special character";break;case"cpassword":if(!e)return"Confirm password is required";if(e!==t)return"Passwords does not match";break;default:return null}})(e,s.body[e],i);t&&u.push(t)})),u.length>0)return e.status(400).json({status:"Failed",error:u});try{if(await r.findOne({$or:[{email:n}]}))return e.status(400).json({status:"Failed",error:"User with this email or username already exists"});const s=new r({firstName:t,lastName:o,email:n,password:i,cpassword:c});await s.save();const u=(l=s.email,a.sign({id:l},process.env.JWT_SECRET,{expiresIn:process.env.JWT_EXPIRES_IN}));e.status(201).json({status:"Success",message:"User saved successfully",user:s,token:u})}catch(s){e.status(500).json({staus:"Failed",error:s.message})}var l}},471:(s,e,t)=>{const r=t(406);e.getAllUser=async(s,e)=>{console.log("users");const{username:t,email:a}=s.query;let o=JSON.stringify(s.query);o=o.replace(/\b gte|gt|lte|lt \b/g,(s=>`$${s}`)),console.log("queryStr-----\n",o),console.log("req-----------\n",t,a);const n=await r.find(JSON.parse(o));e.status(200).json({status:"success",data:n})}},300:(s,e,t)=>{const r=t(773),a=r.createLogger({level:"info",format:r.format.combine(r.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),r.format.errors({stack:!0}),r.format.splat(),r.format.json()),defaultMeta:{service:"Invo Manage"},transports:[new r.transports.File({filename:"error.log",level:"error"}),new r.transports.File({filename:"combined.log"})]});s.exports=a},553:(s,e,t)=>{const r=t(344);e.auth=(s,e,t)=>{const a=s.header("Token");if(!a)return e.status(401).json({status:"failed",message:"token is not found for authorization",statusCode:401});const o=r.decode(a);console.log(o),t()}},406:(s,e,t)=>{const r=t(185),a=t(432),o=new r.Schema({firstName:{type:String,required:!0},lastName:{type:String},email:{type:String,required:!0,validate:{validator:s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),message:"Please enter a valid email address"},unique:[!0,"user already exist"]},password:{type:String,required:!0,validate:{validator:s=>!(s.length<8||!/[A-Z]/.test(s)||!/[a-z]/.test(s)||!/[0-9]/.test(s)||!/[!@#$%^&*]/.test(s)),message:"Password must be at least 8 characters long and include at least one uppercase letter, one lowercase letter, one digit, and one special character."}},cpassword:{type:String,required:!0}},{timestamps:!0});o.methods.correctPassword=async function(s,e){return a.compare(s,e)},o.pre("save",(async function(s){const e=this;if(!e.isModified("password"))return s();try{const t=await a.genSalt(8);e.password=await a.hash(e.password,t),e.cpassword=void 0,s()}catch(e){s(e)}}));const n=r.model("User",o);s.exports=n},322:(s,e,t)=>{const r=t(860),a=t(409),o=r.Router();o.use("/",a),s.exports=o},409:(s,e,t)=>{const{Router:r}=t(860),a=r(),o=t(471),n=t(318),i=t(218),c=t(89);a.post("/signup",n),a.get("/protected",c),a.post("/login",i),a.get("/getAllUser",o.getAllUser),s.exports=a},432:s=>{"use strict";s.exports=require("bcryptjs")},582:s=>{"use strict";s.exports=require("cors")},142:s=>{"use strict";s.exports=require("dotenv")},860:s=>{"use strict";s.exports=require("express")},344:s=>{"use strict";s.exports=require("jsonwebtoken")},185:s=>{"use strict";s.exports=require("mongoose")},773:s=>{"use strict";s.exports=require("winston")}},e={};function t(r){var a=e[r];if(void 0!==a)return a.exports;var o=e[r]={exports:{}};return s[r](o,o.exports,t),o.exports}(()=>{const s=t(860);t(142).config();const e=t(739),r=s(),a=t(185),o=t(582),n=t(300),i=t(322),{auth:c}=t(553);r.use(s.json());const u=["http://localhost:5173","http://localhost:3000"];r.use(o({origin:function(s,e){-1===u.indexOf(s)&&s?e(new Error("Not allowed by CORS")):e(null,!0)},methods:"GET,POST,PUT,DELETE",credentials:!0})),r.use("/",i),r.get("/health",(async(s,e)=>{const t=a.STATES[a.connection.readyState];if("connected"===t)n.info(`mongoDb connection: up, ${t}`),e.status(200).json({status:"up",dbState:t});else{const s=process.env.DB_URL.replace("<username>",process.env.DB_USER).replace("<password>",process.env.DB_PASS);n.info(`mongoDb connection: down, ${t}`),e.status(500).json({status:"down",dbState:t,PORT:s})}}));const l=process.env.PORT||7e3;r.listen(l,(async()=>{try{await e(),console.log("Database connection has been established"),console.log(`Server is running in the port : ${l}`)}catch(s){console.log(`Somthing went wrong: ${s}`)}}))})()})();